<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev-Deck // The Ultimate Arsenal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        html { scroll-behavior: smooth; }
        body { background-color: #0d1117; font-family: 'Inter', sans-serif; }
        .main-gradient-text { background: linear-gradient(90deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background-color: #161b22; border: 1px solid #30363d; transition: all 0.2s ease-in-out; }
        .card:hover { border-color: #3b82f6; transform: translateY(-4px); }
        .btn-primary { background-color: #2563eb; color: white; } .btn-primary:hover { background-color: #1d4ed8; }
        .btn-secondary { background-color: #30363d; color: #c9d1d9; } .btn-secondary:hover { background-color: #484f58; }
        .input-field { background-color: #0d1117; border: 1px solid #30363d; }
        .input-field:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); }
        .modal-content { background-color: #161b22; border: 1px solid #30363d; }
        .spinner { border-color: #3b82f6; border-top-color: transparent; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #0d1117; } ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 4px; }
    </style>
</head>
<body class="text-gray-300">

    <!-- Access Code Login Screen -->
    <div id="loginScreen" class="min-h-screen flex flex-col items-center justify-center p-4 transition-opacity duration-500">
        <div class="text-center w-full max-w-md">
            <h1 class="text-5xl md:text-6xl font-black main-gradient-text mb-4">DEV-DECK</h1>
            <p class="text-gray-400 mb-8">Your Exclusive Developer Arsenal.</p>
            <div class="flex gap-2"><input type="password" id="accessCodeInput" placeholder="Enter Access Code" class="w-full input-field rounded-lg px-4 py-3 text-center transition"><button id="loginBtn" class="btn-primary font-bold px-6 py-3 rounded-lg transition"><i class="fas fa-arrow-right"></i></button></div>
            <p id="loginError" class="text-red-500 mt-4 h-4"></p>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden opacity-0 transition-opacity duration-500">
        <header class="bg-[#161b22]/80 backdrop-blur-sm border-b border-[#30363d] sticky top-0 z-50">
            <nav class="container mx-auto flex justify-between items-center p-4"><h1 class="text-2xl font-bold main-gradient-text">Dev-Deck</h1><div class="flex items-center gap-4"><input id="searchInput" type="text" placeholder="Search..." class="input-field rounded-md px-3 py-1.5 w-40 md:w-64 transition-all"><button id="premiumBtn" class="items-center gap-2 text-yellow-400 font-bold hidden md:flex"><i id="premiumIcon" class="fas fa-star"></i> <span id="premiumStatus">Go Premium</span></button></div></nav>
        </header>
        <main class="container mx-auto p-4 md:p-8">
            <div id="liveDropBanner" class="hidden bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-4 rounded-lg mb-8 text-center font-bold shadow-lg shadow-blue-500/30"></div>
            <div id="resourceGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
        </main>
        <footer class="text-center p-6 mt-12 border-t border-[#30363d]"><p class="text-gray-500">Owner: <a href="https://t.me/nepalxd" target="_blank" class="font-bold text-blue-400 hover:underline">t.me/nepalxd</a></p></footer>
    </div>
    
    <!-- Payment Modal -->
    <div id="paymentModal" class="fixed inset-0 modal-backdrop items-center justify-center z-50 hidden"><div class="modal-content w-full max-w-sm rounded-lg p-6 text-center">
        <!-- Step 1: Initial -->
        <div id="payment-initial">
            <h2 class="text-2xl font-bold mb-2">Unlock Premium</h2><p class="text-gray-400 mb-6">Get lifetime access to all locked resources.</p><img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=upi://pay?pa=fake-id@okhdfc" class="mx-auto border-4 border-gray-600 rounded-lg"><p class="mt-4 text-gray-400">Scan to pay (simulated)</p><button id="simulatePaymentBtn" class="mt-6 w-full bg-blue-600 text-white font-bold py-3 rounded-lg">Simulate Payment</button><button id="closePaymentModal" class="mt-2 w-full text-gray-400">Cancel</button>
        </div>
        <!-- Step 2: Waiting -->
        <div id="payment-waiting" class="hidden"><div class="animate-spin rounded-full h-16 w-16 border-4 spinner mx-auto"></div><h3 class="text-xl font-bold mt-6">Waiting for payment...</h3><p class="text-gray-400">Do not close this window.</p></div>
        <!-- Step 3: Success -->
        <div id="payment-success" class="hidden"><div class="w-16 h-16 rounded-full bg-green-500 flex items-center justify-center mx-auto"><i class="fas fa-check text-white text-3xl"></i></div><h3 class="text-xl font-bold mt-6">Payment Successful!</h3><p class="text-gray-400">Welcome to Premium. Unlocking resources...</p></div>
    </div></div>
    
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-900 border border-blue-500 text-white py-2 px-5 rounded-lg shadow-lg opacity-0 translate-y-10 transition-all duration-300"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const $ = (selector) => document.querySelector(selector);
            let allResources = [], isPremium = false;

            const showToast = (message) => {
                $('#toast').textContent = message;
                $('#toast').classList.remove('opacity-0', 'translate-y-10');
                setTimeout(() => $('#toast').classList.add('opacity-0', 'translate-y-10'), 3000);
            };

            const handleLogin = async () => {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ code: $('#accessCodeInput').value })
                });
                if (response.ok) {
                    $('#loginScreen').classList.add('opacity-0');
                    setTimeout(() => {
                        $('#loginScreen').classList.add('hidden');
                        $('#dashboard').classList.remove('hidden');
                        setTimeout(() => $('#dashboard').classList.remove('opacity-0'), 50);
                        loadDashboard();
                    }, 500);
                } else {
                    $('#loginError').textContent = 'Invalid Access Code';
                    setTimeout(() => $('#loginError').textContent = '', 2000);
                }
            };
            $('#loginBtn').addEventListener('click', handleLogin);
            $('#accessCodeInput').addEventListener('keyup', (e) => e.key === 'Enter' && handleLogin());

            const loadDashboard = async () => {
                try {
                    const response = await fetch('/api/data');
                    const data = await response.json();
                    allResources = data.resources;
                    if(data.settings.live_drop.active) {
                        $('#liveDropBanner').textContent = data.settings.live_drop.message;
                        $('#liveDropBanner').classList.remove('hidden');
                    }
                    renderResources();
                } catch (error) { $('#resourceGrid').innerHTML = '<p class="text-red-500 col-span-full">Failed to load resources.</p>'; }
            };

            const renderResources = (filter = '') => {
                const grid = $('#resourceGrid');
                grid.innerHTML = '';
                const filtered = allResources.filter(r => r.title.toLowerCase().includes(filter.toLowerCase()));
                filtered.forEach(res => {
                    const card = document.createElement('div');
                    card.className = 'card rounded-lg p-5 flex flex-col justify-between';
                    const isLocked = res.premium && !isPremium;
                    card.innerHTML = `
                        <div>
                            <div class="flex items-center gap-4 mb-2">
                                <i class="${res.icon_class} text-2xl text-blue-400 w-8 text-center"></i>
                                <h3 class="text-xl font-bold text-gray-100">${res.title}</h3>
                            </div>
                            <p class="text-gray-400 text-sm mb-4 pl-12">${res.description}</p>
                            <div class="relative pl-12">
                                <input type="text" value="${isLocked ? '••••••••••••••••••••' : res.content}" readonly class="input-field w-full pr-10 rounded-md py-2 px-3 text-sm font-mono">
                                <div class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">${isLocked ? '<i class="fas fa-lock"></i>' : ''}</div>
                            </div>
                        </div>
                        <div class="mt-4 pl-12 grid grid-cols-2 gap-3">
                            <button data-content="${res.content}" class="copy-btn btn-primary font-bold py-2 px-4 rounded-lg flex items-center justify-center gap-2 transition ${isLocked ? 'opacity-50 cursor-not-allowed' : ''}" ${isLocked ? 'disabled' : ''}>
                                <i class="fas fa-copy"></i> COPY
                            </button>
                            <button data-url="${res.download_url}" class="download-btn btn-secondary font-bold py-2 px-4 rounded-lg flex items-center justify-center gap-2 transition ${!res.download_url || isLocked ? 'opacity-50 cursor-not-allowed' : ''}" ${!res.download_url || isLocked ? 'disabled' : ''}>
                                <i class="fas fa-download"></i> DOWNLOAD
                            </button>
                        </div>
                    `;
                    if (isLocked) {
                        card.addEventListener('click', (e) => {
                            if (!e.target.closest('button')) $('#paymentModal').style.display = 'flex';
                        });
                    }
                    grid.appendChild(card);
                });
            };
            $('#searchInput').addEventListener('input', (e) => renderResources(e.target.value));

            $('#resourceGrid').addEventListener('click', (e) => {
                const copyBtn = e.target.closest('.copy-btn');
                if (copyBtn) {
                    navigator.clipboard.writeText(copyBtn.dataset.content);
                    showToast('Copied to clipboard!');
                }
                const downloadBtn = e.target.closest('.download-btn');
                if (downloadBtn) window.open(downloadBtn.dataset.url, '_blank');
            });
            
            // Payment Flow
            $('#premiumBtn').addEventListener('click', () => $('#paymentModal').style.display = 'flex');
            $('#closePaymentModal').addEventListener('click', () => $('#paymentModal').style.display = 'none');
            $('#simulatePaymentBtn').addEventListener('click', () => {
                $('#payment-initial').classList.add('hidden');
                $('#payment-waiting').classList.remove('hidden');
                setTimeout(() => {
                    $('#payment-waiting').classList.add('hidden');
                    $('#payment-success').classList.remove('hidden');
                    setTimeout(() => {
                        $('#paymentModal').style.display = 'none';
                        isPremium = true;
                        $('#premiumStatus').textContent = 'Premium Member';
                        $('#premiumIcon').className = 'fas fa-check-circle text-green-400';
                        renderResources($('#searchInput').value);
                        // Reset modal for next time
                        $('#payment-success').classList.add('hidden');
                        $('#payment-initial').classList.remove('hidden');
                    }, 2000);
                }, 3000);
            });
        });
    </script>
</body>
</html>