<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev-Deck // The Hyper-Interactive Arsenal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        html { scroll-behavior: smooth; }
        body { background-color: #0d1117; font-family: 'Inter', sans-serif; color: #c9d1d9; }
        .main-gradient-text { background: linear-gradient(90deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background-color: #161b22; border: 1px solid #30363d; }
        .btn-primary { background-color: #2563eb; color: white; }
        .input-field { background-color: #0d1117; border: 1px solid #30363d; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); }
        .modal-content { background-color: #161b22; border: 1px solid #30363d; }
    </style>
</head>
<body>

    <!-- Main Application Container -->
    <div id="app">
        
        <!-- Login View -->
        <div id="loginView" class="min-h-screen flex flex-col items-center justify-center p-4">
            <h1 class="text-5xl md:text-6xl font-black main-gradient-text mb-4">DEV-DECK</h1>
            <p class="text-gray-400 mb-2">The Ultimate Digital Arsenal.</p>
            <p class="text-center text-sm text-gray-500 mb-8 max-w-sm">To get your access code, message our Telegram Bot.</p>
            <div class="flex gap-2 w-full max-w-sm">
                <input type="text" id="accessCodeInput" placeholder="Enter Bot-Generated Code" class="input-field w-full rounded-lg px-4 py-3 text-center transition">
                <button id="loginBtn" class="btn-primary font-bold px-6 py-3 rounded-lg transition"><i class="fas fa-arrow-right"></i></button>
            </div>
            <p id="loginError" class="text-red-500 mt-4 h-4"></p>
            <a href="https://t.me/ElderChk_Bot" target="_blank" class="mt-4 text-blue-400 hover:underline">Get Your Code from Telegram Bot</a>
        </div>

        <!-- User Dashboard View -->
        <div id="userDashboardView" class="hidden">
            <!-- Header, Resource Grid, Payment Modal, Live Drop, etc. -->
            <header class="bg-[#161b22]/80 backdrop-blur-sm border-b border-[#30363d] sticky top-0 z-50">
                <nav class="container mx-auto flex justify-between items-center p-4">
                    <h1 class="text-2xl font-bold main-gradient-text">Dev-Deck</h1>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2 text-yellow-400">
                            <i class="fas fa-coins"></i> <span id="userCredits">0</span> Credits
                        </div>
                        <button id="adminPanelBtn" class="hidden bg-red-600 text-white font-bold py-1 px-3 rounded-md text-sm">Admin Panel</button>
                    </div>
                </nav>
            </header>
            <main class="container mx-auto p-4 md:p-8">
                <h2 class="text-2xl font-bold mb-4">Live Drops (Fake Data)</h2>
                <div id="liveDropSection" class="bg-gray-900 border border-gray-800 rounded-lg p-4 font-mono text-green-400 text-sm overflow-hidden h-24"></div>
                
                <h2 class="text-2xl font-bold mt-8 mb-4">Resource Arsenal</h2>
                <div id="resourceGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </main>
            <footer class="text-center p-6 mt-12 border-t border-[#30363d]"><p class="text-gray-500">Owner: <a href="https://t.me/nepalxd" target="_blank" class="font-bold text-blue-400 hover:underline">t.me/nepalxd</a></p></footer>
        </div>

        <!-- Admin Panel View -->
        <div id="adminDashboardView" class="hidden">
            <header class="bg-[#161b22]/80 backdrop-blur-sm border-b border-[#30363d] sticky top-0 z-50">
                <nav class="container mx-auto flex justify-between items-center p-4">
                    <h1 class="text-2xl font-bold text-red-500">Admin Command Center</h1>
                    <button id="exitAdminBtn" class="bg-gray-600 text-white font-bold py-1 px-3 rounded-md text-sm">Exit Admin</button>
                </nav>
            </header>
            <main class="container mx-auto p-4 md:p-8">
                <!-- Admin Stats, Forms for uploading content, user management, etc. -->
                <p>Welcome, Admin. Here you can manage all site content.</p>
                <!-- Add resource form, user list, settings will go here -->
            </main>
        </div>

    </div>

    <script>
        // --- App State & Initialization ---
        const state = {
            currentUser: null,
            resources: [],
            view: 'login', // 'login', 'dashboard', 'admin'
        };

        document.addEventListener('DOMContentLoaded', () => {
            // Check if user session exists in localStorage
            const savedUser = localStorage.getItem('devdeck_user');
            if (savedUser) {
                state.currentUser = JSON.parse(savedUser);
                initDashboard();
            } else {
                showView('login');
            }
        });

        // --- View Router ---
        function showView(viewName) {
            document.getElementById('loginView').classList.add('hidden');
            document.getElementById('userDashboardView').classList.add('hidden');
            document.getElementById('adminDashboardView').classList.add('hidden');
            document.getElementById(`${viewName}View`).classList.remove('hidden');
            state.view = viewName;
        }

        // --- Login Logic ---
        document.getElementById('loginBtn').addEventListener('click', async () => {
            const code = document.getElementById('accessCodeInput').value;
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ code })
            });

            if (response.ok) {
                const userData = await response.json();
                state.currentUser = userData;
                localStorage.setItem('devdeck_user', JSON.stringify(userData));
                initDashboard();
            } else {
                document.getElementById('loginError').textContent = 'Invalid Code. Get one from the Bot.';
            }
        });

        // --- Dashboard Initialization ---
        async function initDashboard() {
            showView('userDashboard');
            document.getElementById('userCredits').textContent = state.currentUser.credits;
            
            if (state.currentUser.isAdmin) {
                document.getElementById('adminPanelBtn').classList.remove('hidden');
            }
            
            const response = await fetch('/api/data');
            const data = await response.json();
            state.resources = data.resources;
            
            renderResources();
            startLiveDrop();
        }

        // --- Rendering Logic ---
        function renderResources() {
            const grid = document.getElementById('resourceGrid');
            grid.innerHTML = '';
            state.resources.forEach(res => {
                const isLocked = res.premium && !state.currentUser.isPremium;
                const card = document.createElement('div');
                card.className = `card rounded-lg p-5 ${isLocked ? 'opacity-60' : ''}`;
                card.innerHTML = `
                    <h3 class="text-xl font-bold">${res.title} ${isLocked ? '<i class="fas fa-lock text-yellow-400 text-sm"></i>' : ''}</h3>
                    <p class="text-gray-400 text-sm mt-2">${res.description}</p>
                    <!-- More details and buttons here -->
                `;
                grid.appendChild(card);
            });
        }
        
        // --- Live Drop ---
        function startLiveDrop() {
            const liveDropEl = document.getElementById('liveDropSection');
            setInterval(async () => {
                const response = await fetch('/api/live-drop');
                const data = await response.json();
                const dropItem = document.createElement('p');
                dropItem.textContent = `> NEW DROP: ${data.cc}`;
                liveDropEl.prepend(dropItem);
                if (liveDropEl.children.length > 5) {
                    liveDropEl.lastChild.remove();
                }
            }, 5000); // New drop every 5 seconds
        }

        // --- Admin Panel Logic ---
        document.getElementById('adminPanelBtn').addEventListener('click', () => showView('adminDashboard'));
        document.getElementById('exitAdminBtn').addEventListener('click', () => showView('userDashboard'));

    </script>
</body>
</html>
